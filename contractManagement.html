<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContractFlow - Vertragsmanagement System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="home-button">Zur Startseite</a>
            <h1>ContractFlow</h1>
            <p>Professionelles Vertragsmanagement System</p>
            <div id="documentInfo" style="font-size: 0.8em; color: #666; margin-top: 10px;"></div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('vertragsgrundlagen', event)">Vertragsgrundlagen</button>
            <button class="nav-tab" onclick="showTab('partner-kontakte', event)">Vertragspartner & Kontakte</button>
            <button class="nav-tab" onclick="showTab('dokumente', event)">Vertragsdokumente</button>
            <button class="nav-tab" onclick="showTab('compliance-monitoring', event)">Compliance & Monitoring</button>
            <button class="nav-tab" onclick="showTab('leistungs-zahlung', event)">Leistungs- & Zahlungsmonitoring</button>
            <button class="nav-tab" onclick="showTab('historie-notizen', event)">Historie & Notizen</button>
            <button class="nav-tab" onclick="showTab('risikomanagement', event)">Risikomanagement</button>
        </div>

        <div class="content">
            <div id="vertragsgrundlagen" class="tab-content active">
                <div class="section">
                    <h2>Vertragsgrundlagen</h2>
                    <h3>Vertragstyp auswählen</h3>
                    <div class="form-group">
                        <label for="contract-type-select">Vertragstyp:</label>
                        <select id="contract-type-select" name="contract-type">
                            <option value="">Bitte wählen Sie einen Vertragstyp</option>
                            <option value="service">Dienstleistungsvertrag</option>
                            <option value="purchase">Kaufvertrag</option>
                            <option value="rental">Mietvertrag</option>
                            <option value="license">Lizenzvertrag</option>
                        </select>
                    </div>
                    <h3>Vertragsidentifikation</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vertragsnummer">Vertragsnummer:</label>
                            <input type="text" id="vertragsnummer" name="vertragsnummer" placeholder="Eindeutige Vertragskennung">
                        </div>
                        <div class="form-group">
                            <label for="vertragsbezeichnung">Vertragsbezeichnung:</label>
                            <input type="text" id="vertragsbezeichnung" name="vertragsbezeichnung" placeholder="Kurze Beschreibung des Vertrags">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vertragspartner">Vertragspartner:</label>
                            <input type="text" id="vertragspartner" name="vertragspartner" placeholder="Name der Vertragspartei">
                        </div>
                        <div class="form-group">
                            <label for="vertragsstatus">Vertragsstatus:</label>
                            <select id="vertragsstatus" name="vertragsstatus">
                                <option value="">Status auswählen</option>
                                <option value="entwurf">Entwurf</option>
                                <option value="verhandlung">In Verhandlung</option>
                                <option value="genehmigung">Zur Genehmigung</option>
                                <option value="aktiv">Aktiv</option>
                                <option value="pausiert">Pausiert</option>
                                <option value="gekuendigt">Gekündigt</option>
                                <option value="abgelaufen">Abgelaufen</option>
                            </select>
                        </div>
                    </div>
                    <h3>Vertragslaufzeit & Termine</h3>
                    <div class="form-row-triple">
                        <div class="form-group">
                            <label for="vertragsbeginn">Vertragsbeginn:</label>
                            <input type="date" id="vertragsbeginn" name="vertragsbeginn">
                        </div>
                        <div class="form-group">
                            <label for="vertragsende">Vertragsende:</label>
                            <input type="date" id="vertragsende" name="vertragsende">
                        </div>
                        <div class="form-group">
                            <label for="kuendigungsfrist">Kündigungsfrist (Tage):</label>
                            <input type="number" id="kuendigungsfrist" name="kuendigungsfrist" placeholder="30">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="automatische-verlaengerung">Automatische Verlängerung:</label>
                            <select id="automatische-verlaengerung" name="automatische-verlaengerung">
                                <option value="nein">Nein</option>
                                <option value="monatlich">Monatlich</option>
                                <option value="quartalsweise">Quartalsweise</option>
                                <option value="jaehrlich">Jährlich</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="naechste-pruefung">Nächste Prüfung:</label>
                            <input type="date" id="naechste-pruefung" name="naechste-pruefung">
                        </div>
                    </div>
                    <h3>Vertragsinhalt & Leistungen</h3>
                    <div class="form-group">
                        <label for="vertragsgegenstand">Vertragsgegenstand:</label>
                        <textarea id="vertragsgegenstand" name="vertragsgegenstand" placeholder="Detaillierte Beschreibung der vereinbarten Leistungen, Produkte oder Dienstleistungen..." class="textarea-large"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="lieferbedingungen">Lieferbedingungen / SLAs:</label>
                        <textarea id="lieferbedingungen" name="lieferbedingungen" placeholder="Lieferzeiten, Service Level Agreements, Qualitätsstandards..."></textarea>
                    </div>
                    <h3>Finanzielle Vereinbarungen</h3>
                    <div class="form-row-triple">
                        <div class="form-group">
                            <label for="gesamtwert">Gesamtwert des Vertrags:</label>
                            <input type="text" id="gesamtwert" name="gesamtwert" placeholder="z.B. 10.000 EUR">
                        </div>
                        <div class="form-group">
                            <label for="zahlungsbedingungen">Zahlungsbedingungen:</label>
                            <input type="text" id="zahlungsbedingungen" name="zahlungsbedingungen" placeholder="z.B. Netto 30 Tage">
                        </div>
                        <div class="form-group">
                            <label for="waehrung">Währung:</label>
                            <select id="waehrung" name="waehrung">
                                <option>EUR</option>
                                <option>USD</option>
                                <option>GBP</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="zahlungshaeufigkeit">Zahlungshäufigkeit:</label>
                        <select id="zahlungshaeufigkeit" name="zahlungshaeufigkeit">
                            <option value="einmalig">Einmalig</option>
                            <option value="monatlich">Monatlich</option>
                            <option value="quartalsweise">Quartalsweise</option>
                            <option value="jaehrlich">Jährlich</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="partner-kontakte" class="tab-content">
                <div class="section">
                    <h2>Vertragspartner & Kontakte</h2>
                    <h3>Hauptansprechpartner</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ansprechpartner-name">Name:</label>
                            <input type="text" id="ansprechpartner-name" name="ansprechpartner-name" placeholder="Name des Ansprechpartners">
                        </div>
                        <div class="form-group">
                            <label for="ansprechpartner-email">E-Mail:</label>
                            <input type="email" id="ansprechpartner-email" name="ansprechpartner-email" placeholder="E-Mail des Ansprechpartners">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ansprechpartner-telefon">Telefon:</label>
                            <input type="tel" id="ansprechpartner-telefon" name="ansprechpartner-telefon" placeholder="Telefonnummer">
                        </div>
                        <div class="form-group">
                            <label for="ansprechpartner-position">Position:</label>
                            <input type="text" id="ansprechpartner-position" name="ansprechpartner-position" placeholder="Position im Unternehmen">
                        </div>
                    </div>
                    <h3>Weitere Kontakte</h3>
                    <div id="additionalContacts">
                        </div>
                    <button type="button" class="btn btn-secondary" onclick="addContact()">+ Weiteren Kontakt hinzufügen</button>
                </div>
            </div>

            <div id="dokumente" class="tab-content">
                <div class="section">
                    <h2>Vertragsdokumente</h2>
                    <div class="form-group document-upload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Dokumente hierher ziehen oder <label for="file-upload" style="display: inline; cursor: pointer; color: #4f46e5; text-decoration: underline;">hochladen</label></p>
                        <input type="file" id="file-upload" multiple style="display: none;">
                    </div>
                    <div id="uploadedDocuments">
                        </div>
                </div>
            </div>

            <div id="compliance-monitoring" class="tab-content">
                <div class="section">
                    <h2>Compliance & Monitoring</h2>
                    <h3>Wichtige Verpflichtungen & Fristen</h3>
                    <div id="obligationsTableContainer">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Beschreibung der Verpflichtung</th>
                                    <th>Frist</th>
                                    <th>Verantwortlicher</th>
                                    <th>Status</th>
                                    <th>Aktion</th>
                                </tr>
                            </thead>
                            <tbody id="obligationsTableBody">
                                </tbody>
                        </table>
                        <button type="button" class="btn btn-secondary" onclick="addObligationRow()">+ Weitere Verpflichtung hinzufügen</button>
                    </div>
                    <h3>Audit-Historie</h3>
                    <div id="auditHistory">
                        </div>
                    <button type="button" class="btn btn-secondary" onclick="addAuditEntry()">+ Audit-Eintrag hinzufügen</button>
                </div>
            </div>

            <div id="leistungs-zahlung" class="tab-content">
                <div class="section">
                    <h2>Leistungs- & Zahlungsmonitoring</h2>
                    <h3>Aktueller Leistungsstand</h3>
                    <div class="form-group">
                        <label for="leistungsstand">Aktueller Leistungsstand:</label>
                        <input type="range" id="leistungsstand" name="leistungsstand" min="0" max="100" value="50" oninput="updateLeistungsstand(this.value)">
                        <p id="leistungsstand-text">50% erfüllt</p>
                    </div>
                    <h3>Zahlungshistorie</h3>
                    <div id="paymentHistory">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Rechnungsnummer</th>
                                    <th>Datum</th>
                                    <th>Betrag</th>
                                    <th>Status</th>
                                    <th>Aktion</th>
                                </tr>
                            </thead>
                            <tbody id="paymentTableBody">
                                </tbody>
                        </table>
                        <button type="button" class="btn btn-secondary" onclick="addPaymentEntry()">+ Zahlungseintrag hinzufügen</button>
                    </div>
                </div>
            </div>

            <div id="historie-notizen" class="tab-content">
                <div class="section">
                    <h2>Historie & Notizen</h2>
                    <h3>Versionshistorie</h3>
                    <div id="versionHistory">
                        </div>
                    <button type="button" class="btn btn-secondary" onclick="addVersionEntry()">+ Version hinzufügen</button>

                    <h3>Interne Notizen</h3>
                    <div class="form-group">
                        <textarea id="internalNotes" placeholder="Fügen Sie hier interne Notizen oder Kommentare hinzu."></textarea>
                    </div>
                </div>
            </div>

            <div id="risikomanagement" class="tab-content">
                <div class="section">
                    <h2>Risikomanagement</h2>
                    <h3>Vertragliche Risiken</h3>
                    <div id="contractRisks">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Risikobeschreibung</th>
                                    <th>Kategorie</th>
                                    <th>Eintrittswahrscheinlichkeit</th>
                                    <th>Auswirkung</th>
                                    <th>Maßnahme</th>
                                    <th>Verantwortlicher</th>
                                    <th>Status</th>
                                    <th>Aktion</th>
                                </tr>
                            </thead>
                            <tbody id="riskTableBody">
                                </tbody>
                        </table>
                        <button type="button" class="btn btn-secondary" onclick="addRiskEntry()">+ Risiko hinzufügen</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="actions">
            <button class="btn btn-secondary" onclick="printDocument()">📄 Dokument drucken</button>
            <button class="btn btn-primary" onclick="exportStaticHtml()">💾 Dokument speichern</button>
            <button class="btn btn-success" onclick="exportHandover()">🔄 Übergabe-Paket exportieren</button>
        
    </div>

    

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const documentInfoDiv = document.getElementById('documentInfo');
            if (documentInfoDiv) {
                documentInfoDiv.innerHTML = `Version 1.0 (Stand: ${new Date().toLocaleDateString('de-DE')})`;
            }
        });

        // Function to show/hide tabs - adjusted to use 'nav-tab' and 'tab-content'
        function showTab(tabName, event) {
            let i, tabcontent, navlinks;

            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }

            navlinks = document.getElementsByClassName("nav-tab");
            for (i = 0; i < navlinks.length; i++) {
                navlinks[i].classList.remove("active");
            }

            document.getElementById(tabName).style.display = "block";
            document.getElementById(tabName).classList.add("active");
            if (event) {
                event.currentTarget.classList.add("active");
            }
        }

        // Set default open tab on page load
        document.addEventListener("DOMContentLoaded", function() {
            // Get the first tab button and trigger its click event
            const firstTabButton = document.querySelector(".nav-tab");
            if (firstTabButton) {
                firstTabButton.click();
            }
        });

        // Specific functions for Contract Management System
        // Removed selectContractType function as it's no longer needed for a <select> element.

        function addContact() {
            const container = document.getElementById('additionalContacts');
            const newContactHtml = `
                <div class="stakeholder-item"> <button type="button" class="delete-button" onclick="deleteItem(this)">X</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Name:</label>
                            <input type="text" class="contact-name" placeholder="Name des Kontakts">
                        </div>
                        <div class="form-group">
                            <label>E-Mail:</label>
                            <input type="email" class="contact-email" placeholder="E-Mail des Kontakts">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Telefon:</label>
                            <input type="tel" class="contact-phone" placeholder="Telefonnummer">
                        </div>
                        <div class="form-group">
                            <label>Position:</label>
                            <input type="text" class="contact-position" placeholder="Position">
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newContactHtml);
        }

        function deleteItem(buttonElement) {
            buttonElement.closest('.stakeholder-item, .obligation-row, .audit-item, .payment-row, .version-item, .risk-row, li').remove();
        }


        function addObligationRow() {
            const tbody = document.getElementById('obligationsTableBody');
            const newRow = `
                <tr class="obligation-row">
                    <td><input type="text" class="obligation-description" placeholder="Verpflichtungsbeschreibung"></td>
                    <td><input type="date" class="obligation-date"></td>
                    <td><input type="text" class="obligation-responsible" placeholder="Verantwortlicher"></td>
                    <td>
                        <select class="obligation-status">
                            <option>Offen</option>
                            <option>In Bearbeitung</option>
                            <option>Erfüllt</option>
                            <option>Überfällig</option>
                        </select>
                    </td>
                    <td><button type="button" class="delete-button" onclick="deleteItem(this)">X</button></td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', newRow);
        }

        function addAuditEntry() {
            const container = document.getElementById('auditHistory');
            const newAuditHtml = `
                <div class="stakeholder-item audit-item"> <button type="button" class="delete-button" onclick="deleteItem(this)">X</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Datum des Audits:</label>
                            <input type="date" class="audit-date">
                        </div>
                        <div class="form-group">
                            <label>Auditor:</label>
                            <input type="text" class="audit-auditor" placeholder="Name des Auditors">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ergebnisse & Empfehlungen:</label>
                        <textarea class="audit-results" placeholder="Zusammenfassung der Audit-Ergebnisse und Empfehlungen"></textarea>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newAuditHtml);
        }

        function updateLeistungsstand(value) {
            document.getElementById('leistungsstand-text').textContent = value + '% erfüllt';
        }

        function addPaymentEntry() {
            const tbody = document.getElementById('paymentTableBody');
            const newRow = `
                <tr class="payment-row">
                    <td><input type="text" class="payment-invoice" placeholder="Rechnungsnummer"></td>
                    <td><input type="date" class="payment-date"></td>
                    <td><input type="text" class="payment-amount" placeholder="Betrag"></td>
                    <td>
                        <select class="payment-status">
                            <option>Offen</option>
                            <option>Bezahlt</option>
                            <option>Überfällig</option>
                        </select>
                    </td>
                    <td><button type="button" class="delete-button" onclick="deleteItem(this)">X</button></td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', newRow);
        }

        function addVersionEntry() {
            const container = document.getElementById('versionHistory');
            const newVersionHtml = `
                <div class="stakeholder-item version-item">
                    <button type="button" class="delete-button" onclick="deleteItem(this)">X</button>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Version:</label>
                            <input type="text" class="version-number" placeholder="z.B. 1.0, 1.1">
                        </div>
                        <div class="form-group">
                            <label>Datum:</label>
                            <input type="date" class="version-date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Änderungen:</label>
                        <textarea class="version-changes" placeholder="Beschreibung der Änderungen in dieser Version"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Autor:</label>
                        <input type="text" class="version-author" placeholder="Name des Autors">
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newVersionHtml);
        }

        function addRiskEntry() {
            const tbody = document.getElementById('riskTableBody');
            const newRow = `
                <tr class="risk-row">
                    <td><input type="text" class="risk-description" placeholder="Risikobeschreibung"></td>
                    <td>
                        <select class="risk-category">
                            <option>Rechtlich</option>
                            <option>Finanziell</option>
                            <option>Operationell</option>
                            <option>Reputation</option>
                        </select>
                    </td>
                    <td>
                        <select class="risk-probability">
                            <option>Niedrig</option>
                            <option>Mittel</option>
                            <option>Hoch</option>
                        </select>
                    </td>
                    <td>
                        <select class="risk-impact">
                            <option>Gering</option>
                            <option>Mittel</option>
                            <option>Hoch</option>
                        </select>
                    </td>
                    <td><input type="text" class="risk-measure" placeholder="Maßnahme zur Minderung"></td>
                    <td><input type="text" class="risk-responsible" placeholder="Verantwortlicher"></td>
                    <td>
                        <select class="risk-status">
                            <option>Offen</option>
                            <option>In Bearbeitung</option>
                            <option>Geschlossen</option>
                        </select>
                    </td>
                    <td><button type="button" class="delete-button" onclick="deleteItem(this)">X</button></td>
                </tr>
            `;
            tbody.insertAdjacentHTML('beforeend', newRow);
        }

        // Helper function to create a data row div
        function createDataRow(label, value) {
            const div = document.createElement('div');
            div.classList.add('data-row');
            const labelSpan = document.createElement('span');
            labelSpan.classList.add('data-label');
            labelSpan.textContent = label;
            const valueSpan = document.createElement('span');
            valueSpan.classList.add('data-value');
            // Using innerHTML here for potential <br> tags from newlines
            valueSpan.innerHTML = (value || 'Nicht angegeben').replace(/\n/g, '<br>');
            div.appendChild(labelSpan);
            div.appendChild(valueSpan);
            return div;
        }

        // Helper function to create a paragraph
        function createParagraph(text) {
            const p = document.createElement('p');
            p.innerHTML = (text || 'Nicht angegeben').replace(/\n/g, '<br>'); // Use innerHTML to preserve line breaks
            return p;
        }

        // Export functionality for Contract Management (New Approach: DOM Manipulation)
        function exportStaticHtml() {
            // Create a new document to build the static HTML
            const doc = document.implementation.createHTMLDocument();
            const head = doc.head;
            const body = doc.body;

            // Add styles to the new document
            const style = doc.createElement('style');
            style.textContent = `
                /* General Styles for Consistency (from styles.css) */
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    background: #f0f2f5; /* Simplified background for static export */
                    padding: 20px;
                }

                .report-container {
                    max-width: 900px;
                    margin: 20px auto;
                    background: white;
                    padding: 30px;
                    border-radius: 8px;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }

                .header-exported { /* Custom class for the exported header */
                    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                    color: white;
                    padding: 30px;
                    text-align: center;
                    border-radius: 8px 8px 0 0;
                    margin: -30px -30px 30px -30px; /* Adjust to fill container width */
                }

                .header-exported h1 {
                    font-size: 2.2em;
                    margin-bottom: 10px;
                    font-weight: 300;
                }

                .header-exported p {
                    font-size: 1.1em;
                    opacity: 0.9;
                }
                
                .document-info { font-size: 0.8em; color: rgba(255,255,255,0.7); margin-top: 10px; }


                h2, h3, h4 { color: #2c3e50; margin-top: 25px; margin-bottom: 10px; }
                h2 { font-size: 1.8em; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px; }
                h3 { font-size: 1.3em; margin-bottom: 15px; }
                h4 { font-size: 1.1em; margin-bottom: 10px; color: #4f46e5; }
                
                .section { margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
                .form-group p, .data-item p { margin-bottom: 10px; padding-left: 10px; }
                .form-group label, .data-item label { font-weight: bold; margin-bottom: 5px; display: block; color: #555; }
                
                .data-row { display: flex; margin-bottom: 8px; }
                .data-label { font-weight: bold; width: 220px; color: #555; flex-shrink: 0; }
                .data-value { flex-grow: 1; word-wrap: break-word; }
                p { margin: 0 0 10px 0; }
                ul { list-style: inside disc; padding-left: 20px; margin-bottom: 10px; }
                ul li { margin-bottom: 5px; }
                
                table.output-table { /* Specific style for tables in the output */
                    width: 100%;
                    border-collapse: collapse;
                    margin-top: 15px;
                    margin-bottom: 20px;
                    background: white;
                    border-radius: 8px;
                    overflow: hidden;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
                    table-layout: auto;
                }
                .output-table th, .output-table td {
                    border: 1px solid #ddd;
                    padding: 10px;
                    text-align: left;
                    word-wrap: break-word;
                    vertical-align: top; /* Align content to top for multi-line */
                }
                .output-table th { background-color: #f0f4f8; font-weight: bold; }
                .output-table tr:nth-child(even) { background-color: #fcfdff; }

                .status-badge {
                    display: inline-block;
                    padding: 5px 10px;
                    border-radius: 5px;
                    font-size: 0.85em;
                    font-weight: 600;
                }
                .status-badge.entwurf { background-color: #adb5bd; color: white; }
                .status-badge.verhandlung { background-color: #ffc107; color: #333; }
                .status-badge.genehmigung { background-color: #17a2b8; color: white; }
                .status-badge.aktiv { background-color: #28a745; color: white; }
                .status-badge.pausiert { background-color: #6c757d; color: white; }
                .status-badge.gekuendigt { background-color: #dc3545; color: white; }
                .status-badge.abgelaufen { background-color: #6c757d; color: white; }
                .status-badge.offen { background-color: #007bff; color: white; }
                .status-badge.inbearbeitung { background-color: #ffc107; color: #333; }
                .status-badge.erfuellt { background-color: #28a745; color: white; }
                .status-badge.überfällig { background-color: #dc3545; color: white; }
                .status-badge.bezahlt { background-color: #28a745; color: white; }
                .status-badge.niedrig { background-color: #2ecc71; color: white; }
                .status-badge.mittel { background-color: #f1c40f; color: #333; }
                .status-badge.hoch { background-color: #e74c3c; color: white; }


                @media (max-width: 768px) {
                    .data-row { flex-direction: column; }
                    .data-label { width: 100%; margin-bottom: 5px; }
                    .report-container { padding: 15px; }
                }
            `;
            head.appendChild(style);

            // Create main container
            const containerDiv = doc.createElement('div');
            containerDiv.classList.add('report-container');
            body.appendChild(containerDiv);

            // Create and append the header
            const headerDiv = doc.createElement('div');
            headerDiv.classList.add('header-exported');
            const headerH1 = doc.createElement('h1');
            headerH1.textContent = 'ContractFlow';
            const headerP = doc.createElement('p');
            headerP.textContent = 'Professionelles Vertragsmanagement System';
            const documentInfoDiv = doc.createElement('div');
            documentInfoDiv.classList.add('document-info');
            documentInfoDiv.innerHTML = `Version 1.0 (Stand: ${new Date().toLocaleDateString('de-DE')})`;

            headerDiv.appendChild(headerH1);
            headerDiv.appendChild(headerP);
            headerDiv.appendChild(documentInfoDiv); // Append version info to exported header
            containerDiv.appendChild(headerDiv);

            // --- Vertragsgrundlagen ---
            const h2Grundlagen = doc.createElement('h2');
            h2Grundlagen.textContent = 'Vertragsgrundlagen';
            containerDiv.appendChild(h2Grundlagen);

            // Fetch selected contract type from the new select element
            const contractTypeSelect = document.getElementById('contract-type-select');
            const selectedContractTypeText = contractTypeSelect.options[contractTypeSelect.selectedIndex].text;
            containerDiv.appendChild(createDataRow('Vertragstyp:', selectedContractTypeText));


            containerDiv.appendChild(createDataRow('Vertragsnummer:', document.getElementById('vertragsnummer').value));
            containerDiv.appendChild(createDataRow('Vertragsbezeichnung:', document.getElementById('vertragsbezeichnung').value));
            containerDiv.appendChild(createDataRow('Vertragspartner:', document.getElementById('vertragspartner').value));
            containerDiv.appendChild(createDataRow('Vertragsstatus:', `<span class="status-badge ${document.getElementById('vertragsstatus').value.toLowerCase()}">${document.getElementById('vertragsstatus').value}</span>`));
            containerDiv.appendChild(createDataRow('Vertragsbeginn:', document.getElementById('vertragsbeginn').value));
            containerDiv.appendChild(createDataRow('Vertragsende:', document.getElementById('vertragsende').value));
            containerDiv.appendChild(createDataRow('Kündigungsfrist:', (document.getElementById('kuendigungsfrist').value || 'Nicht angegeben') + ' Tage'));
            containerDiv.appendChild(createDataRow('Automatische Verlängerung:', document.getElementById('automatische-verlaengerung').value));
            containerDiv.appendChild(createDataRow('Nächste Prüfung:', document.getElementById('naechste-pruefung').value));

            const h3Inhalt = doc.createElement('h3');
            h3Inhalt.textContent = 'Vertragsinhalt & Leistungen';
            containerDiv.appendChild(h3Inhalt);
            containerDiv.appendChild(createDataRow('Vertragsgegenstand:')); // Label only
            containerDiv.appendChild(createParagraph(document.getElementById('vertragsgegenstand').value));
            containerDiv.appendChild(createDataRow('Lieferbedingungen / SLAs:')); // Label only
            containerDiv.appendChild(createParagraph(document.getElementById('lieferbedingungen').value));

            const h3Finanzen = doc.createElement('h3');
            h3Finanzen.textContent = 'Finanzielle Vereinbarungen';
            containerDiv.appendChild(h3Finanzen);
            containerDiv.appendChild(createDataRow('Gesamtwert:', (document.getElementById('gesamtwert').value || 'Nicht angegeben') + ' ' + (document.getElementById('waehrung').value || '')));
            containerDiv.appendChild(createDataRow('Zahlungsbedingungen:', document.getElementById('zahlungsbedingungen').value));
            containerDiv.appendChild(createDataRow('Zahlungshäufigkeit:', document.getElementById('zahlungshaeufigkeit').value));

            // --- Vertragspartner & Kontakte ---
            const h2Kontakte = doc.createElement('h2');
            h2Kontakte.textContent = 'Vertragspartner & Kontakte';
            containerDiv.appendChild(h2Kontakte);

            const h3Hauptkontakt = doc.createElement('h3');
            h3Hauptkontakt.textContent = 'Hauptansprechpartner';
            containerDiv.appendChild(h3Hauptkontakt);
            containerDiv.appendChild(createDataRow('Name:', document.getElementById('ansprechpartner-name').value));
            containerDiv.appendChild(createDataRow('E-Mail:', document.getElementById('ansprechpartner-email').value));
            containerDiv.appendChild(createDataRow('Telefon:', document.getElementById('ansprechpartner-telefon').value));
            containerDiv.appendChild(createDataRow('Position:', document.getElementById('ansprechpartner-position').value));

            const h3WeitereKontakte = doc.createElement('h3');
            h3WeitereKontakte.textContent = 'Weitere Kontakte';
            containerDiv.appendChild(h3WeitereKontakte);

            const additionalContacts = document.querySelectorAll('#additionalContacts .stakeholder-item');
            if (additionalContacts.length > 0) {
                additionalContacts.forEach((contactItem, index) => {
                    const h4Contact = doc.createElement('h4');
                    h4Contact.textContent = `Weiterer Kontakt ${index + 1}`;
                    containerDiv.appendChild(h4Contact);
                    containerDiv.appendChild(createDataRow('Name:', contactItem.querySelector('.contact-name').value));
                    containerDiv.appendChild(createDataRow('E-Mail:', contactItem.querySelector('.contact-email').value));
                    containerDiv.appendChild(createDataRow('Telefon:', contactItem.querySelector('.contact-phone').value));
                    containerDiv.appendChild(createDataRow('Position:', contactItem.querySelector('.contact-position').value));
                });
            } else {
                containerDiv.appendChild(createParagraph('Keine weiteren Kontakte erfasst.'));
            }

            // --- Vertragsdokumente ---
            const h2Dokumente = doc.createElement('h2');
            h2Dokumente.textContent = 'Vertragsdokumente';
            containerDiv.appendChild(h2Dokumente);

            const uploadedDocuments = document.querySelectorAll('#uploadedDocuments li');
            if (uploadedDocuments.length > 0) {
                const ul = doc.createElement('ul');
                uploadedDocuments.forEach(docItem => {
                    const li = doc.createElement('li');
                    li.textContent = docItem.childNodes[0] ? docItem.childNodes[0].textContent.trim() : 'Nicht angegeben';
                    ul.appendChild(li);
                });
                containerDiv.appendChild(ul);
            } else {
                containerDiv.appendChild(createParagraph('Keine Dokumente hochgeladen.'));
            }

            // --- Compliance & Monitoring ---
            const h2Compliance = doc.createElement('h2');
            h2Compliance.textContent = 'Compliance & Monitoring';
            containerDiv.appendChild(h2Compliance);

            const h3Verpflichtungen = doc.createElement('h3');
            h3Verpflichtungen.textContent = 'Wichtige Verpflichtungen & Fristen';
            containerDiv.appendChild(h3Verpflichtungen);

            const obligations = document.querySelectorAll('#obligationsTableBody tr');
            if (obligations.length > 0) {
                const table = doc.createElement('table');
                table.classList.add('output-table'); // Add class for styling
                const thead = doc.createElement('thead');
                const tbody = doc.createElement('tbody');
                table.appendChild(thead);
                table.appendChild(tbody);

                const headerRow = doc.createElement('tr');
                ['Beschreibung', 'Frist', 'Verantwortlicher', 'Status'].forEach(text => {
                    const th = doc.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                obligations.forEach(row => {
                    const tr = doc.createElement('tr');
                    const description = row.querySelector('.obligation-description').value || 'Nicht angegeben';
                    const date = row.querySelector('.obligation-date').value || 'Nicht angegeben';
                    const responsible = row.querySelector('.obligation-responsible').value || 'Nicht angegeben';
                    const statusValue = row.querySelector('.obligation-status').value || 'Nicht angegeben';
                    const statusHtml = `<span class="status-badge ${statusValue.toLowerCase().replace(/ /g, '')}">${statusValue}</span>`;

                    [description, date, responsible, statusHtml].forEach(value => {
                        const td = doc.createElement('td');
                        td.innerHTML = value; // Use innerHTML for status badge
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                containerDiv.appendChild(table);
            } else {
                containerDiv.appendChild(createParagraph('Keine Verpflichtungen erfasst.'));
            }

            const h3Audit = doc.createElement('h3');
            h3Audit.textContent = 'Audit-Historie';
            containerDiv.appendChild(h3Audit);

            const auditEntries = document.querySelectorAll('#auditHistory .audit-item');
            if (auditEntries.length > 0) {
                auditEntries.forEach((auditItem, index) => {
                    const h4Audit = doc.createElement('h4');
                    h4Audit.textContent = `Audit Eintrag ${index + 1}`;
                    containerDiv.appendChild(h4Audit);
                    containerDiv.appendChild(createDataRow('Datum des Audits:', auditItem.querySelector('.audit-date').value));
                    containerDiv.appendChild(createDataRow('Auditor:', auditItem.querySelector('.audit-auditor').value));
                    containerDiv.appendChild(createDataRow('Ergebnisse & Empfehlungen:')); // Label only
                    containerDiv.appendChild(createParagraph(auditItem.querySelector('.audit-results').value));
                });
            } else {
                containerDiv.appendChild(createParagraph('Keine Audit-Einträge erfasst.'));
            }

            // --- Leistungs- & Zahlungsmonitoring ---
            const h2LeistungZahlung = doc.createElement('h2');
            h2LeistungZahlung.textContent = 'Leistungs- & Zahlungsmonitoring';
            containerDiv.appendChild(h2LeistungZahlung);

            const h3Leistungsstand = doc.createElement('h3');
            h3Leistungsstand.textContent = 'Aktueller Leistungsstand';
            containerDiv.appendChild(h3Leistungsstand);
            containerDiv.appendChild(createDataRow('Aktueller Leistungsstand:', (document.getElementById('leistungsstand').value || 'Nicht angegeben') + '% erfüllt'));

            const h3Zahlungshistorie = doc.createElement('h3');
            h3Zahlungshistorie.textContent = 'Zahlungshistorie';
            containerDiv.appendChild(h3Zahlungshistorie);

            const paymentEntries = document.querySelectorAll('#paymentTableBody tr');
            if (paymentEntries.length > 0) {
                const table = doc.createElement('table');
                table.classList.add('output-table'); // Add class for styling
                const thead = doc.createElement('thead');
                const tbody = doc.createElement('tbody');
                table.appendChild(thead);
                table.appendChild(tbody);

                const headerRow = doc.createElement('tr');
                ['Rechnungsnummer', 'Datum', 'Betrag', 'Status'].forEach(text => {
                    const th = doc.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                paymentEntries.forEach(row => {
                    const tr = doc.createElement('tr');
                    const invoice = row.querySelector('.payment-invoice').value || 'Nicht angegeben';
                    const date = row.querySelector('.payment-date').value || 'Nicht angegeben';
                    const amount = row.querySelector('.payment-amount').value || 'Nicht angegeben';
                    const statusValue = row.querySelector('.payment-status').value || 'Nicht angegeben';
                    const statusHtml = `<span class="status-badge ${statusValue.toLowerCase().replace(/ /g, '')}">${statusValue}</span>`;

                    [invoice, date, amount, statusHtml].forEach(value => {
                        const td = doc.createElement('td');
                        td.innerHTML = value; // Use innerHTML for status badge
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                containerDiv.appendChild(table);
            } else {
                containerDiv.appendChild(createParagraph('Keine Zahlungseinträge erfasst.'));
            }

            // --- Historie & Notizen ---
            const h2HistorieNotizen = doc.createElement('h2');
            h2HistorieNotizen.textContent = 'Historie & Notizen';
            containerDiv.appendChild(h2HistorieNotizen);

            const h3Versionshistorie = doc.createElement('h3');
            h3Versionshistorie.textContent = 'Versionshistorie';
            containerDiv.appendChild(h3Versionshistorie);

            const versionEntries = document.querySelectorAll('#versionHistory .version-item');
            if (versionEntries.length > 0) {
                versionEntries.forEach((versionItem, index) => {
                    const h4Version = doc.createElement('h4');
                    h4Version.textContent = `Version ${versionItem.querySelector('.version-number').value || 'Nicht angegeben'}`;
                    containerDiv.appendChild(h4Version);
                    containerDiv.appendChild(createDataRow('Datum:', versionItem.querySelector('.version-date').value));
                    containerDiv.appendChild(createDataRow('Autor:', versionItem.querySelector('.version-author').value));
                    containerDiv.appendChild(createDataRow('Änderungen:')); // Label only
                    containerDiv.appendChild(createParagraph(versionItem.querySelector('.version-changes').value));
                });
            } else {
                containerDiv.appendChild(createParagraph('Keine Versionseinträge erfasst.'));
            }

            const h3InterneNotizen = doc.createElement('h3');
            h3InterneNotizen.textContent = 'Interne Notizen';
            containerDiv.appendChild(h3InterneNotizen);
            containerDiv.appendChild(createParagraph(document.getElementById('internalNotes').value));

            // --- Risikomanagement ---
            const h2Risikomanagement = doc.createElement('h2');
            h2Risikomanagement.textContent = 'Risikomanagement';
            containerDiv.appendChild(h2Risikomanagement);

            const h3VertraglicheRisiken = doc.createElement('h3');
            h3VertraglicheRisiken.textContent = 'Vertragliche Risiken';
            containerDiv.appendChild(h3VertraglicheRisiken);

            const riskEntries = document.querySelectorAll('#riskTableBody tr');
            if (riskEntries.length > 0) {
                const table = doc.createElement('table');
                table.classList.add('output-table'); // Add class for styling
                const thead = doc.createElement('thead');
                const tbody = doc.createElement('tbody');
                table.appendChild(thead);
                table.appendChild(tbody);

                const headerRow = doc.createElement('tr');
                ['Beschreibung', 'Kategorie', 'Wahrscheinlichkeit', 'Auswirkung', 'Maßnahme', 'Verantwortlicher', 'Status'].forEach(text => {
                    const th = doc.createElement('th');
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                riskEntries.forEach(row => {
                    const tr = doc.createElement('tr');
                    const description = row.querySelector('.risk-description').value || 'Nicht angegeben';
                    const category = row.querySelector('.risk-category').value || 'Nicht angegeben';
                    const probabilityValue = row.querySelector('.risk-probability').value || 'Nicht angegeben';
                    const impactValue = row.querySelector('.risk-impact').value || 'Nicht angegeben';
                    const measure = row.querySelector('.risk-measure').value || 'Nicht angegeben';
                    const responsible = row.querySelector('.risk-responsible').value || 'Nicht angegeben';
                    const statusValue = row.querySelector('.risk-status').value || 'Nicht angegeben';
                    
                    const probabilityHtml = `<span class="status-badge ${probabilityValue.toLowerCase().replace(/ /g, '')}">${probabilityValue}</span>`;
                    const impactHtml = `<span class="status-badge ${impactValue.toLowerCase().replace(/ /g, '')}">${impactValue}</span>`;
                    const statusHtml = `<span class="status-badge ${statusValue.toLowerCase().replace(/ /g, '')}">${statusValue}</span>`;

                    [description, category, probabilityHtml, impactHtml, measure, responsible, statusHtml].forEach(value => {
                        const td = doc.createElement('td');
                        td.innerHTML = value; // Use innerHTML for status badges
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
                containerDiv.appendChild(table);
            } else {
                containerDiv.appendChild(createParagraph('Keine Risikoeinträge erfasst.'));
            }

            // Serialize the entire new document to a string
            const staticHtmlContent = `<!DOCTYPE html>${doc.documentElement.outerHTML}`;

            const blob = new Blob([staticHtmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Vertragsdokumentation_${(document.getElementById('vertragsbezeichnung').value || 'Unbenannter Vertrag').replace(/[^a-z0-9]/gi, '_')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('Statische HTML-Dokumentation erstellt!');
        }


        function exportHandover() {
            alert('Übergabe-Paket Export würde hier implementiert werden - alle relevanten Dokumente und Daten für nahtlose Übergabe');
        }

        // Event listener for file upload
        document.getElementById('file-upload').addEventListener('change', function(event) {
            const files = event.target.files;
            const uploadedDocumentsList = document.getElementById('uploadedDocuments');
            for (const file of files) {
                const listItem = document.createElement('li');
                listItem.textContent = file.name;
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'X';
                deleteButton.classList.add('delete-button'); // Use existing delete button style
                deleteButton.onclick = function() {
                    listItem.remove();
                };
                listItem.appendChild(deleteButton);
                uploadedDocumentsList.appendChild(listItem);
            }
        });

    </script>
</body>
</html>